
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../dataset/">
      
      
        <link rel="next" href="../utils/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Prompt Formatting - SimpleLLaMA Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#prompt-formatting" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="SimpleLLaMA Documentation" class="md-header__button md-logo" aria-label="SimpleLLaMA Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SimpleLLaMA Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Prompt Formatting
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="SimpleLLaMA Documentation" class="md-nav__button md-logo" aria-label="SimpleLLaMA Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    SimpleLLaMA Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pretraining
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Pretraining
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pretraining/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pretraining/dataset/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dataset Preparation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tokenization
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Tokenization
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pretraining/tokenization/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pretraining/tokenization/algorithms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Algorithms
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pretraining/tokenization/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pretraining/tokenization/project/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Project Usage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Model Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Model Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pretraining/model_architecture/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pretraining/model_architecture/embeddings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Embeddings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pretraining/model_architecture/attention/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Attention
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pretraining/model_architecture/normalization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Normalization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pretraining/model_architecture/feedforward/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FeedForward
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pretraining/model_architecture/decoder_block/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Layer Block
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pretraining/model_architecture/end_to_end/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    End To End
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Training Process (Beginner)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Training Process (Beginner)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pretraining/training_beginner/introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pretraining/training_beginner/model_config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Model Configurations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pretraining/training_beginner/dataset_and_batching/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dataset and Batching
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pretraining/training_beginner/scheduler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Scheduler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pretraining/training_beginner/training_loop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Training Loop
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Training Process (Advanced)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            Training Process (Advanced)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pretraining/training_advanced/recap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basics Recap
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pretraining/training_advanced/optimizers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Optimizer Details
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pretraining/training_advanced/loss_function/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cross Entropy Loss
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pretraining/training_advanced/gradient_accumulation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gradient Accumulation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pretraining/training_advanced/ddp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Distributed Data Parallel
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pretraining/training_advanced/throughput_optimizations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Throughput Optimizations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pretraining/training_advanced/ckpt_and_eval/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Checkpointing and Evaluations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pretraining/training_advanced/final_walkthrough/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Final Walkthrough
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Supervised Fine-Tuning
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Supervised Fine-Tuning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataset/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dataset
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Prompt Formatting
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Prompt Formatting
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-prompt-formatting-matters" class="md-nav__link">
    <span class="md-ellipsis">
      Why Prompt Formatting Matters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#special-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      Special Tokens
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prompt-formatting_1" class="md-nav__link">
    <span class="md-ellipsis">
      Prompt Formatting
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-formatting-function" class="md-nav__link">
    <span class="md-ellipsis">
      The Formatting Function
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Formatting Function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-walkthrough" class="md-nav__link">
    <span class="md-ellipsis">
      Example Walkthrough
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Utilities
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../finetuning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Finetuning Process
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    RLHF
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            RLHF
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rlhf/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rlhf/methods/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Methods
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Misc
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Misc
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/benchmarking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Benchmarking
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/inference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Inference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Notes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Custom Training
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Custom Training
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../custom_training/pretraining/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pretraining
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../custom_training/sft/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Supervised Fine Tuning
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../custom_training/rlhf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RLHF
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-prompt-formatting-matters" class="md-nav__link">
    <span class="md-ellipsis">
      Why Prompt Formatting Matters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#special-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      Special Tokens
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prompt-formatting_1" class="md-nav__link">
    <span class="md-ellipsis">
      Prompt Formatting
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-formatting-function" class="md-nav__link">
    <span class="md-ellipsis">
      The Formatting Function
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Formatting Function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-walkthrough" class="md-nav__link">
    <span class="md-ellipsis">
      Example Walkthrough
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="prompt-formatting">Prompt Formatting</h1>
<p>When creating a supervised fine-tuning (SFT) dataset, one of the most critical stages is how the data is <em>formatted</em> before it ever reaches the model. Even if the dataset contains high-quality examples, the model will not learn properly if the structure is inconsistent, ambiguous, or misaligned between inputs and outputs. </p>
<p>The formatting process for this project is handled by two main functions: <code>format_training_prompt</code> and <code>format_inference_prompt</code>, located in <code>simple_llama\finetune\format_llm_prompt.py</code>. Together, these functions take the raw dataset entries and transform them into structured prompts that include special tokens. These tokens act like markers that clearly delineate system instructions, user input, and assistant responses. By enforcing this strict formatting scheme, we create a consistent “language of conversation structure” that the model can rely on.</p>
<hr />
<h2 id="why-prompt-formatting-matters">Why Prompt Formatting Matters</h2>
<p>To understand why prompt formatting matters so much, it helps to recall what pretraining and supervised fine-tuning are doing differently. Pretraining exposes the model to raw text data, teaching it general language patterns and next-token prediction. However, the model has no inherent concept of conversation, alignment, or task boundaries. Without explicit formatting, the model cannot distinguish between <em>instruction</em>, <em>query</em>, and <em>response</em>.</p>
<p>For example, if we simply gave the model text like:</p>
<div class="highlight"><pre><span></span><code>User: What is 2+2?
Assistant: 4
</code></pre></div>
<p>it might appear obvious to us, but the model does not know that “User” is a role marker, that “Assistant” should follow with an aligned answer, or that there are clear start and end boundaries for each role. Worse, if the formatting changes from example to example (sometimes <code>Q:</code> and <code>A:</code>, sometimes <code>Human:</code> and <code>AI:</code>), the model will learn a messy, inconsistent interface.</p>
<p>The use of special tokens like <code>&lt;SOT&gt;</code>, <code>&lt;SOU&gt;</code>, and <code>&lt;SOA&gt;</code> solves this problem by creating unambiguous delimiters. Every prompt has the same structure. The model sees not only the words but also these unique markers, which act like anchors in the training data. Over time, the model comes to associate <code>&lt;SOU&gt;</code> with the beginning of a user message, <code>&lt;SOA&gt;</code> with the start of its own reply, and <code>&lt;EOA&gt;</code> with the conclusion of its generated output. This consistency is what makes supervised fine-tuning effective for the model to learn. </p>
<hr />
<h2 id="special-tokens">Special Tokens</h2>
<p>It is worth emphasizing why this token scheme works so well. Transformers do not understand roles, but they are excellent at picking up statistical regularities. By embedding special tokens directly into the training data, we effectively give the model a rule for conversational formats. The <code>&lt;SOT&gt;</code> token always signals the beginning of the context, <code>&lt;SOU&gt;</code> always signals a human query, and <code>&lt;SOA&gt;</code> always signals the assistant’s role.</p>
<p>Here is the list of special tokens used during Supervised Fine Tuning:  </p>
<ul>
<li><code>&lt;SOT&gt;</code>: (Start of Template) Marks the start of System Prompt</li>
<li><code>&lt;EOT&gt;</code>: (End of Template) Marks the end of System Prompt</li>
<li><code>&lt;SOU&gt;</code>: (Start of User) Marks the start of User Query</li>
<li><code>&lt;EOU&gt;</code>: (End of User) Marks the end of User Query</li>
<li><code>&lt;SOA&gt;</code>: (Start of Assistant) Marks the start of Assistant Response</li>
<li><code>&lt;EOA&gt;</code>: (End of Assistant) Marks the end of Assistant Response</li>
</ul>
<p>In addition to those Start/Ending special token markers, there's also a special <code>&lt;PAD&gt;</code> token used to pad the example sequences until they are of uniform length. Further details will be covered in the <code>utils</code> section</p>
<hr />
<h2 id="prompt-formatting_1">Prompt Formatting</h2>
<p>Prompt formatting is a crucial step in supervised fine-tuning (SFT). It defines how raw conversational data—system prompts, user messages, and assistant responses—are transformed into the structured sequences that the model will see during training. Without careful formatting, the model may learn the wrong objectives (such as imitating the user or repeating system messages), which can reduce the quality and reliability of responses.</p>
<hr />
<h2 id="the-formatting-function">The Formatting Function</h2>
<p>The project defines a central function, <code>format_training_prompt</code>, that prepares data for SFT. Here is the actual implementation:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">format_training_prompt</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">assistant</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">template</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Formats conversation into a single training prompt with special tokens.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A tuple of:</span>
<span class="sd">            - formatted_prompt (str): Full prompt string with system prompt, user turns, and assistant responses.</span>
<span class="sd">            - target_response (str): Only the final assistant response (with &lt;EOA&gt;), to be used for loss masking.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - The full prompt is structured with &lt;SOT&gt;, &lt;EOT&gt;, &lt;SOU&gt;, &lt;EOU&gt;, &lt;SOA&gt;, and &lt;EOA&gt; tokens.</span>
<span class="sd">        - If template == &#39;CUSTOM&#39;, default system prompt will be used</span>
<span class="sd">        - Assumes assistant[-1] is the target response we want to supervise on.</span>

<span class="sd">    Example:</span>
<span class="sd">        full_prompt, target = format_training_prompt([&quot;Hi&quot;], [&quot;Hello there.&quot;], &quot;CUSTOM&quot;)</span>
<span class="sd">        full_prompt -&gt; &quot;&lt;SOT&gt;...&lt;SOU&gt;Hi&lt;EOU&gt;...&lt;SOA&gt;Hello there.&lt;EOA&gt;&quot;</span>
<span class="sd">        target      -&gt; &quot;Hello there.&lt;EOA&gt;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">assistant</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Number of user strings, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">user</span><span class="p">)</span><span class="si">=}</span><span class="s2">, must be equal to number of assistant strings, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">assistant</span><span class="p">)</span><span class="si">=}</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="n">template</span> <span class="o">==</span> <span class="s2">&quot;CUSTOM&quot;</span><span class="p">:</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">SYSTEM_PROMPT</span>

    <span class="n">concat_UA</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;&lt;SOU&gt;</span><span class="si">{</span><span class="n">u</span><span class="si">}</span><span class="s2">&lt;EOU&gt;</span><span class="se">\n</span><span class="s2">&lt;SOA&gt;</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">&lt;EOA&gt;&quot;</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">assistant</span><span class="p">)]</span>
    <span class="n">joined_UA</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">concat_UA</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;SOT&gt;</span><span class="si">{</span><span class="n">template</span><span class="si">}</span><span class="s2">&lt;EOT&gt;</span><span class="se">\n\n</span><span class="si">{</span><span class="n">joined_UA</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">assistant</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;EOA&gt;&quot;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Final response mismatch:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Expected ending: &#39;</span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Actual ending:   &#39;</span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]):]</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span>
</code></pre></div>
<p>The function accepts three arguments:  </p>
<ul>
<li><code>user</code>: a list of user queries (strings). Each element is one user message.  </li>
<li><code>assistant</code>: a list of assistant responses (strings). Each element corresponds to the user message at the same index.  </li>
<li><code>template</code>: a string that specifies the system prompt. If <code>"CUSTOM"</code> is provided, the function automatically inserts the project’s <strong>default system prompt</strong> (a general instruction describing the model’s role and behavior).  </li>
</ul>
<p>The formatting process proceeds in several stages:</p>
<ol>
<li>
<p><strong>System Prompt Wrapping</strong><br />
   The system-level template is wrapped in special start and end tokens:<br />
   <div class="highlight"><pre><span></span><code>&lt;SOT&gt; ... &lt;EOT&gt;
</code></pre></div>
   This ensures the model can clearly distinguish between global instructions and user/assistant turns.</p>
</li>
<li>
<p><strong>User–Assistant Turns</strong><br />
   Each user input is wrapped with <code>&lt;SOU&gt; ... &lt;EOU&gt;</code>, and each assistant reply is wrapped with <code>&lt;SOA&gt; ... &lt;EOA&gt;</code>. These pairs are concatenated sequentially:<br />
   <div class="highlight"><pre><span></span><code>&lt;SOU&gt;User message&lt;EOU&gt;
&lt;SOA&gt;Assistant response&lt;EOA&gt;
</code></pre></div>
   If there are multiple conversational turns, they are joined together with line breaks.</p>
</li>
<li>
<p><strong>Final Data Output</strong><br />
   The function returns a tuple <code>(full_prompt, target_response)</code>:  </p>
</li>
<li><strong>full_prompt</strong>: Contains the system template and the entire conversation history, including all user messages and assistant replies.  </li>
<li><strong>target_response</strong>: Only the <strong>last assistant reply</strong> (ending with <code>&lt;EOA&gt;</code>). Loss is calculated exclusively on this portion.  </li>
</ol>
<p>This final design prevents the model from being penalized for predicting the system or user text, and instead forces learning to focus on producing the assistant’s output.</p>
<hr />
<h3 id="example-walkthrough">Example Walkthrough</h3>
<p>Let’s take a minimal example with a single turn:</p>
<div class="highlight"><pre><span></span><code><span class="n">full_prompt</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">format_training_prompt</span><span class="p">(</span>
    <span class="n">user</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;What is 2+2?&quot;</span><span class="p">],</span>
    <span class="n">assistant</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;4&quot;</span><span class="p">],</span>
    <span class="n">template</span><span class="o">=</span><span class="s2">&quot;CUSTOM&quot;</span>
<span class="p">)</span>
</code></pre></div>
<p>The result would be:</p>
<div class="highlight"><pre><span></span><code>full_prompt =
&lt;SOT&gt;Your name is Simple LLaMA - a language model...&lt;EOT&gt;

&lt;SOU&gt;What is 2+2?&lt;EOU&gt;
&lt;SOA&gt;4&lt;EOA&gt;



target =
4&lt;EOA&gt;
</code></pre></div>
<p>Here the system prompt is replaced with the project’s default instructions, because the template argument was <code>"CUSTOM"</code>. The <code>full_prompt</code> contains everything, but the <code>target</code> is only the final assistant response. This allows us to mask loss outside of the assistant’s output.</p>
<p>For multi-turn conversations:</p>
<div class="highlight"><pre><span></span><code><span class="n">full_prompt</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">format_training_prompt</span><span class="p">(</span>
    <span class="n">user</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;What is the capital of France?&quot;</span><span class="p">,</span> <span class="s2">&quot;I see. What about the capital of Japan?&quot;</span><span class="p">],</span>
    <span class="n">assistant</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;The capital of France is Paris.&quot;</span><span class="p">,</span> <span class="s2">&quot;It is Japan.&quot;</span><span class="p">],</span>
    <span class="n">template</span><span class="o">=</span><span class="s2">&quot;CUSTOM&quot;</span>
<span class="p">)</span>
</code></pre></div>
<p>We would get:</p>
<div class="highlight"><pre><span></span><code>full_prompt =
&lt;SOT&gt;Your name is Simple LLaMA...&lt;EOT&gt;

&lt;SOU&gt;What is the capital of France?&lt;EOU&gt;
&lt;SOA&gt;The capital of France is Paris.&lt;EOA&gt;

&lt;SOU&gt;I see. What about the capital of Japan?&lt;EOU&gt;
&lt;SOA&gt;It is Japan.&lt;EOA&gt;



target =
It is Japan.&lt;EOA&gt;
</code></pre></div>
<p>Notice how only the final assistant reply is selected for loss.</p>
<p>This formatting convention enforces <strong>role separation</strong>. The model is never trained to generate user queries or repeat system instructions—it is only trained to complete the assistant’s role. This distinction is essential for alignment: the assistant role must remain coherent and helpful across turns, while system and user text is treated as conditioning context only.</p>
<p>By structuring prompts this way, we also make it easy to scale up to multi-turn conversations without ambiguity. Each turn is delimited with clear markers, ensuring that the model can track conversational roles and responsibilities.</p>
<hr />
<h3 id="summary">Summary</h3>
<ul>
<li>The function <code>format_training_prompt</code> converts raw system, user, and assistant data into structured training-ready text.  </li>
<li>System instructions are wrapped with <code>&lt;SOT&gt;</code> and <code>&lt;EOT&gt;</code>.  </li>
<li>User and assistant turns are wrapped with <code>&lt;SOU&gt; ... &lt;EOU&gt;</code> and <code>&lt;SOA&gt; ... &lt;EOA&gt;</code>.  </li>
<li>The function outputs <code>(full_prompt, target_response)</code>, where only the final assistant response is used for loss calculation.  </li>
</ul>
<p>This design provides clarity in supervised fine-tuning, to make sure that the model learns to generate assistant responses without being distracted by other roles in the conversation.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.math"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>